<po-page-default>

  <nav class="custom-navbar">
    <!-- Navbar Title (optional logo or text) -->
    <div class="navbar-logo">
    </div>

  </nav>


  <form [formGroup]="myForm">
  <po-stepper
    #stepper
    [p-orientation]="orientation"
    [p-align-center]="true"
    [p-step-size]="32"
  >
    <po-step p-label="Início de rota">
      <div class="po-mt-1">
          <!-- First Widget with LabelNow Input -->
          <po-widget class="po-mt-1">

            <po-info p-label="Data e hora" [p-value]="labelNow"> </po-info>
            <po-info p-label="Obra" [p-value]="userService.user?.obra"> </po-info>
            <po-info p-label="Operador e placa" [p-value]="getDisplayNameAndPlate()"> </po-info>

            <br>
            <po-multiselect
              #multiSelect
              class=" po-mb-5 po-mt-3"
              formControlName="contact"
              (p-change)="changeOptions($event)"
              p-field-value="uid"
              [p-hide-select-all]="true"
              p-label="Operadores"
              [p-options]="optionsOperators"
              p-field-label="displayName"
              p-icon="ph ph-user"
              p-placeholder="Selecione o operador"
              required
            >
            </po-multiselect>

            <br>
            <po-combo
              name="combo"
              class="po-mb-1"
              formControlName="service"
              p-label="Serviço"
              p-placeholder="Selecione o serviço"
              [p-options]="optionsServices"
              required
            >
            </po-combo>
          </po-widget>

          <!-- Button to Start Route -->
          <po-button
            class="po-md-12 po-mt-5"
            p-kind="primary"
            p-label="Iniciar Rota"
            [p-disabled]="myForm.invalid"
            (p-click)="onHandleStartRoute('startRoute')"
          ></po-button>
      </div>
    </po-step>

    <po-step p-label="Coletar fotos">
      <!-- Button Groups -->

      <div class="camera-container">

        <!-- Display the webcam feed -->
        <div class="po-text-center">
          <webcam
            [height]="350"
            [width]="300"
            [trigger]="triggerObservable"
            (imageCapture)="handleImage($event)"
            [allowCameraSwitch]="allowCameraSwitch"
            [switchCamera]="nextWebcamObservable"
            [videoOptions]="videoOptions"
            (cameraSwitched)="cameraWasSwitched($event)"
            (initError)="handleInitError($event)"
            >
          </webcam>
        </div>

        <po-info class="po-md-12" p-label="Data e hora" [p-value]="labelNow"> </po-info>
        <po-textarea
          p-label="Observação"
          class="po-md-12">
        </po-textarea>
        <div class="po-text-center">
          <po-button
            (p-click)="triggerSnapshot()"
            p-label="Tirar foto">
          </po-button>
        </div>

        <po-button
          class="po-md-12 po-mb-1 po-mt-1"
          (p-click)="handleStepper()"
          [p-disabled]="!webcamImage"
          p-label="Finalizar diária">
        </po-button>

      </div>
    </po-step>

    <po-step p-label="Finalizar">
      <!-- Button Groups -->
      <po-textarea
        name="textarea"
        class="po-md-12 po-mt-3"
        p-label="Detalhes"
        [p-rows]="6"
      ></po-textarea>

      <po-button
        class="po-md-12"
        p-kind="tertiary"
        p-label="Coletar Assinaturas"
        [p-disabled]="true"
        (p-click)="onHandleStartRoute('startRoute')"
      ></po-button>
    </po-step>
  </po-stepper>

</form>

</po-page-default>

<po-modal
  #modal
  p-title="Iniciar rota"
  [p-primary-action]="confirm"
  [p-secondary-action]="close"
  >
  <po-info class="po-md-12 po-mt-1" p-label="Data e hora" [p-value]="labelNow"> </po-info>
  <po-info class="po-md-12 po-mt-1" p-label="Obra" [p-value]="  userService.user?.obra"> </po-info>
  <po-info class="po-md-12 po-mt-1" p-label="serviço" [p-value]="myForm.get('service')!.value"> </po-info>


</po-modal>


<po-modal
  #modalTwo
  p-title="Confirmar"
  [p-primary-action]="confirmPhoto"
  [p-secondary-action]="closePhoto"
  >
  <po-image *ngIf="webcamImage"
    [p-src]="webcamImage.imageAsDataUrl">
  </po-image>
  <po-info class="po-md-12 po-mt-1" p-label="Data e hora" [p-value]="labelNow"> </po-info>
  <po-info class="po-md-12 po-mt-1" p-label="Observações" [p-value]="myForm.get('obs')?.value"> </po-info>

</po-modal>
